<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corim Interpreter - Workflow Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #e0e0e0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #00d9ff;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }
        .diagram-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        .diagram-section h2 {
            color: #00d9ff;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            padding-bottom: 10px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
        }
        .phase-lexer { background: #e74c3c; }
        .phase-parser { background: #f39c12; }
        .phase-interpreter { background: #27ae60; }
        .phase-data { background: #3498db; }
        .phase-output { background: #9b59b6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÆ Corim Interpreter Workflow</h1>
        <p class="subtitle">From Source Code to Execution</p>

        <!-- Main Pipeline -->
        <div class="diagram-section">
            <h2>üìä High-Level Pipeline</h2>
            <div class="mermaid">
flowchart LR
    subgraph Input
        A[/"üìÑ Source Code<br>let x = 1 + 2"/]
    end
    
    subgraph Lexer["üî¥ LEXER"]
        B["Tokenizer<br>Lexer.java"]
    end
    
    subgraph Tokens
        C[/"üîµ Tokens<br>[LET][ID 'x'][=][1][+][2]"/]
    end
    
    subgraph Parser["üü† PARSER"]
        D["Recursive Descent<br>Parser.java"]
    end
    
    subgraph AST
        E[/"üîµ Abstract Syntax Tree<br>LetStatement ‚Üí BinaryExpr"/]
    end
    
    subgraph Interpreter["üü¢ INTERPRETER"]
        F["Tree Walker<br>Interpreter.java"]
    end
    
    subgraph Output
        G[/"üü£ Result<br>x = 3"/]
    end
    
    A --> B --> C --> D --> E --> F --> G
    
    style A fill:#1e3a5f,stroke:#3498db,color:#fff
    style B fill:#c0392b,stroke:#e74c3c,color:#fff
    style C fill:#1e3a5f,stroke:#3498db,color:#fff
    style D fill:#d68910,stroke:#f39c12,color:#fff
    style E fill:#1e3a5f,stroke:#3498db,color:#fff
    style F fill:#1e8449,stroke:#27ae60,color:#fff
    style G fill:#6c3483,stroke:#9b59b6,color:#fff
            </div>
        </div>

        <!-- Lexer Details -->
        <div class="diagram-section">
            <h2>üî¥ Phase 1: Lexical Analysis (Lexer)</h2>
            <div class="mermaid">
flowchart TB
    subgraph Input
        SRC["Source: let x = 10 + 5"]
    end
    
    subgraph Lexer["Lexer.java"]
        direction TB
        L1["Initialize pointers<br>start=0, current=0, line=1"]
        L2{"Read next<br>character"}
        L3{"Character<br>type?"}
        
        L4["Letter ‚Üí identifier()"]
        L5["Digit ‚Üí number()"]
        L6["Quote ‚Üí string()"]
        L7["Operator ‚Üí addToken()"]
        L8["Whitespace ‚Üí skip"]
        L9["Newline ‚Üí line++"]
        
        L10["Create Token<br>(type, lexeme, literal, line)"]
        L11{"End of<br>source?"}
        L12["Add EOF token"]
    end
    
    subgraph TokenTypes["TokenType.java"]
        T1["INTEGER"]
        T2["STRING"]
        T3["IDENTIFIER"]
        T4["Keywords:<br>LET, PRINT, IF..."]
        T5["Operators:<br>PLUS, MINUS..."]
    end
    
    subgraph Output
        TOKENS["Token List:<br>[LET 'let']<br>[ID 'x']<br>[ASSIGN '=']<br>[INT 10]<br>[PLUS '+']<br>[INT 5]<br>[EOF]"]
    end
    
    SRC --> L1 --> L2 --> L3
    L3 --> L4 & L5 & L6 & L7 & L8 & L9
    L4 & L5 & L6 & L7 --> L10
    L8 & L9 --> L2
    L10 --> L11
    L11 -->|No| L2
    L11 -->|Yes| L12 --> TOKENS
    
    T1 & T2 & T3 & T4 & T5 -.-> L10
    
    style SRC fill:#1e3a5f,stroke:#3498db,color:#fff
    style TOKENS fill:#1e3a5f,stroke:#3498db,color:#fff
    style L1 fill:#c0392b,stroke:#e74c3c,color:#fff
    style L2 fill:#c0392b,stroke:#e74c3c,color:#fff
    style L3 fill:#c0392b,stroke:#e74c3c,color:#fff
    style L10 fill:#c0392b,stroke:#e74c3c,color:#fff
    style L12 fill:#c0392b,stroke:#e74c3c,color:#fff
            </div>
        </div>

        <!-- Parser Details -->
        <div class="diagram-section">
            <h2>üü† Phase 2: Parsing (Recursive Descent)</h2>
            <div class="mermaid">
flowchart TB
    subgraph Input
        TOKENS["Token Stream"]
    end
    
    subgraph Parser["Parser.java - Recursive Descent"]
        direction TB
        P1["parse()"]
        P2["parseStatement()"]
        
        subgraph Statements
            S1["parseLetStatement()"]
            S2["parsePrintStatement()"]
            S3["parseIfStatement()"]
            S4["parseWhileStatement()"]
            S5["parseFunctionDefinition()"]
            S6["parseReturnStatement()"]
        end
        
        subgraph Expressions["Expression Parsing (by precedence)"]
            E1["parseOr() ‚Üí ||"]
            E2["parseAnd() ‚Üí &&"]
            E3["parseEquality() ‚Üí ==, !="]
            E4["parseComparison() ‚Üí <, >, <=, >="]
            E5["parseTerm() ‚Üí +, -"]
            E6["parseFactor() ‚Üí *, /, %"]
            E7["parseUnary() ‚Üí -, !"]
            E8["parseCall() ‚Üí func()"]
            E9["parsePrimary() ‚Üí literals, ids, ( )"]
        end
    end
    
    subgraph AST["AST Nodes"]
        direction TB
        subgraph StmtNodes["Statement Nodes"]
            AS1["LetStatement"]
            AS2["PrintStatement"]
            AS3["IfStatement"]
            AS4["WhileStatement"]
            AS5["FunctionStatement"]
        end
        subgraph ExprNodes["Expression Nodes"]
            AE1["IntegerLiteral"]
            AE2["StringLiteral"]
            AE3["Identifier"]
            AE4["BinaryExpression"]
            AE5["CallExpression"]
        end
    end
    
    TOKENS --> P1 --> P2
    P2 --> S1 & S2 & S3 & S4 & S5 & S6
    S1 & S2 & S3 & S4 --> E1
    E1 --> E2 --> E3 --> E4 --> E5 --> E6 --> E7 --> E8 --> E9
    
    S1 --> AS1
    S2 --> AS2
    S3 --> AS3
    S4 --> AS4
    S5 --> AS5
    E9 --> AE1 & AE2 & AE3
    E5 & E6 --> AE4
    E8 --> AE5
    
    style TOKENS fill:#1e3a5f,stroke:#3498db,color:#fff
    style P1 fill:#d68910,stroke:#f39c12,color:#fff
    style P2 fill:#d68910,stroke:#f39c12,color:#fff
            </div>
        </div>

        <!-- Operator Precedence -->
        <div class="diagram-section">
            <h2>üéØ Operator Precedence (Low ‚Üí High)</h2>
            <div class="mermaid">
flowchart LR
    subgraph Precedence["Parsing Order: Each level calls the next"]
        P1["1Ô∏è‚É£ OR<br>||"]
        P2["2Ô∏è‚É£ AND<br>&&"]
        P3["3Ô∏è‚É£ EQUALITY<br>== !="]
        P4["4Ô∏è‚É£ COMPARISON<br>< > <= >="]
        P5["5Ô∏è‚É£ TERM<br>+ -"]
        P6["6Ô∏è‚É£ FACTOR<br>* / %"]
        P7["7Ô∏è‚É£ UNARY<br>- !"]
        P8["8Ô∏è‚É£ CALL<br>fn()"]
        P9["9Ô∏è‚É£ PRIMARY<br>42, 'str', x, ()"]
    end
    
    P1 -->|"calls"| P2 -->|"calls"| P3 -->|"calls"| P4 -->|"calls"| P5 -->|"calls"| P6 -->|"calls"| P7 -->|"calls"| P8 -->|"calls"| P9
    
    style P1 fill:#8e44ad,stroke:#9b59b6,color:#fff
    style P2 fill:#8e44ad,stroke:#9b59b6,color:#fff
    style P3 fill:#2980b9,stroke:#3498db,color:#fff
    style P4 fill:#2980b9,stroke:#3498db,color:#fff
    style P5 fill:#27ae60,stroke:#2ecc71,color:#fff
    style P6 fill:#27ae60,stroke:#2ecc71,color:#fff
    style P7 fill:#d68910,stroke:#f39c12,color:#fff
    style P8 fill:#d68910,stroke:#f39c12,color:#fff
    style P9 fill:#c0392b,stroke:#e74c3c,color:#fff
            </div>
        </div>

        <!-- AST Example -->
        <div class="diagram-section">
            <h2>üå≥ AST Example: let x = 1 + 2 * 3</h2>
            <div class="mermaid">
flowchart TB
    subgraph AST["Abstract Syntax Tree"]
        LET["LetStatement<br>name: 'x'"]
        
        PLUS["BinaryExpression<br>operator: +"]
        
        INT1["IntegerLiteral<br>value: 1"]
        
        MULT["BinaryExpression<br>operator: *"]
        
        INT2["IntegerLiteral<br>value: 2"]
        INT3["IntegerLiteral<br>value: 3"]
    end
    
    LET -->|"initializer"| PLUS
    PLUS -->|"left"| INT1
    PLUS -->|"right"| MULT
    MULT -->|"left"| INT2
    MULT -->|"right"| INT3
    
    style LET fill:#d68910,stroke:#f39c12,color:#fff
    style PLUS fill:#27ae60,stroke:#2ecc71,color:#fff
    style MULT fill:#27ae60,stroke:#2ecc71,color:#fff
    style INT1 fill:#3498db,stroke:#5dade2,color:#fff
    style INT2 fill:#3498db,stroke:#5dade2,color:#fff
    style INT3 fill:#3498db,stroke:#5dade2,color:#fff
            </div>
            <p style="text-align: center; margin-top: 15px; color: #888;">
                Note: * binds tighter than +, so (2 * 3) is evaluated first ‚Üí 1 + 6 = 7
            </p>
        </div>

        <!-- Interpreter Details -->
        <div class="diagram-section">
            <h2>üü¢ Phase 3: Interpretation (Tree Walking)</h2>
            <div class="mermaid">
flowchart TB
    subgraph Input
        AST["AST"]
    end
    
    subgraph Interpreter["Interpreter.java"]
        direction TB
        I1["interpret(statements)"]
        I2["execute(statement)"]
        I3["evaluate(expression)"]
        
        subgraph Visitors["Visitor Methods"]
            V1["visitLetStatement()"]
            V2["visitPrintStatement()"]
            V3["visitIfStatement()"]
            V4["visitWhileStatement()"]
            V5["visitBinaryExpression()"]
            V6["visitCallExpression()"]
        end
    end
    
    subgraph Environment["Environment.java"]
        ENV["Variable Storage<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>x ‚Üí 10<br>factorial ‚Üí fn<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>‚Üë enclosing"]
    end
    
    subgraph Functions
        direction TB
        UDF["CorimFunction<br>User-defined"]
        BIF["BuiltinFunction<br>len, abs, min..."]
    end
    
    subgraph ControlFlow["Control Flow (Exceptions)"]
        CF1["ReturnException"]
        CF2["BreakException"]
        CF3["ContinueException"]
    end
    
    subgraph Output
        OUT["Console Output /<br>Return Values"]
    end
    
    AST --> I1 --> I2 --> V1 & V2 & V3 & V4
    I2 --> I3 --> V5 & V6
    
    V1 -->|"define"| ENV
    V5 -->|"get"| ENV
    V6 --> UDF & BIF
    
    V4 --> CF2 & CF3
    UDF --> CF1
    
    V2 --> OUT
    V6 --> OUT
    
    style AST fill:#1e3a5f,stroke:#3498db,color:#fff
    style I1 fill:#1e8449,stroke:#27ae60,color:#fff
    style I2 fill:#1e8449,stroke:#27ae60,color:#fff
    style I3 fill:#1e8449,stroke:#27ae60,color:#fff
    style ENV fill:#8e44ad,stroke:#9b59b6,color:#fff
    style OUT fill:#6c3483,stroke:#9b59b6,color:#fff
            </div>
        </div>

        <!-- Scope Chain -->
        <div class="diagram-section">
            <h2>üîó Environment Scope Chain</h2>
            <div class="mermaid">
flowchart TB
    subgraph Code["Source Code"]
        C1["let x = 10<br>let add = fn(a, b) {<br>&nbsp;&nbsp;let sum = a + b<br>&nbsp;&nbsp;return sum<br>}<br>print add(3, 4)"]
    end
    
    subgraph Scopes["Runtime Scope Chain"]
        direction TB
        GLOBAL["üåç Global Environment<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>x ‚Üí 10<br>add ‚Üí CorimFunction<br>len ‚Üí BuiltinFunction<br>abs ‚Üí BuiltinFunction"]
        
        FUNC["üì¶ Function Environment<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>a ‚Üí 3<br>b ‚Üí 4<br>sum ‚Üí 7<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>enclosing ‚Üì"]
    end
    
    GLOBAL ---|"Parent Scope"| FUNC
    
    subgraph Lookup["Variable Lookup: 'x'"]
        L1["1. Check FUNC env"]
        L2["2. Not found"]
        L3["3. Check GLOBAL env"]
        L4["4. Found: x = 10"]
    end
    
    L1 --> L2 --> L3 --> L4
    
    style GLOBAL fill:#1e8449,stroke:#27ae60,color:#fff
    style FUNC fill:#2980b9,stroke:#3498db,color:#fff
            </div>
        </div>

        <!-- Function Call -->
        <div class="diagram-section">
            <h2>üìû Function Call Execution: factorial(3)</h2>
            <div class="mermaid">
sequenceDiagram
    participant Main as Main Program
    participant I as Interpreter
    participant E as Environment
    participant F as factorial(n)
    
    Main->>I: evaluate CallExpr(factorial, [3])
    I->>E: get("factorial") ‚Üí CorimFunction
    I->>I: Create new Environment(closure)
    I->>E: define("n", 3)
    
    rect rgb(40, 40, 80)
        Note over F: factorial(3)
        I->>F: execute body
        F->>I: evaluate: n <= 1 ‚Üí false
        F->>I: evaluate: n * factorial(n-1)
        I->>I: Call factorial(2)
        
        rect rgb(50, 50, 100)
            Note over F: factorial(2)
            I->>F: execute body
            F->>I: evaluate: n <= 1 ‚Üí false
            F->>I: evaluate: n * factorial(n-1)
            I->>I: Call factorial(1)
            
            rect rgb(60, 60, 120)
                Note over F: factorial(1)
                I->>F: execute body
                F->>I: evaluate: n <= 1 ‚Üí true
                F-->>I: throw ReturnException(1)
            end
            
            I->>I: 2 * 1 = 2
            F-->>I: throw ReturnException(2)
        end
        
        I->>I: 3 * 2 = 6
        F-->>I: throw ReturnException(6)
    end
    
    I-->>Main: return 6
            </div>
        </div>

        <!-- File Structure -->
        <div class="diagram-section">
            <h2>üìÅ Project File Structure</h2>
            <div class="mermaid">
flowchart LR
    subgraph Project["corim/"]
        subgraph Src["src/"]
            MAIN["Corim.java<br>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br>Entry Point<br>REPL + File Runner"]
            
            subgraph LexerPkg["lexer/"]
                LX1["TokenType.java"]
                LX2["Token.java"]
                LX3["Lexer.java"]
            end
            
            subgraph ParserPkg["parser/"]
                PS1["Parser.java"]
                subgraph AstPkg["ast/"]
                    AST1["Expression.java"]
                    AST2["Statement.java"]
                end
            end
            
            subgraph InterpPkg["interpreter/"]
                IN1["Interpreter.java"]
                IN2["Environment.java"]
                IN3["CorimFunction.java"]
                IN4["BuiltinFunction.java"]
                IN5["ReturnException.java"]
                IN6["BreakException.java"]
                IN7["ContinueException.java"]
            end
        end
        
        subgraph Examples["examples/"]
            EX1["demo.corim"]
            EX2["simple.corim"]
        end
    end
    
    MAIN --> LX3
    LX3 --> PS1
    PS1 --> IN1
    
    style MAIN fill:#c0392b,stroke:#e74c3c,color:#fff
    style LX3 fill:#d68910,stroke:#f39c12,color:#fff
    style PS1 fill:#27ae60,stroke:#2ecc71,color:#fff
    style IN1 fill:#2980b9,stroke:#3498db,color:#fff
            </div>
        </div>

        <!-- Adding New Features -->
        <div class="diagram-section">
            <h2>‚ûï How to Add New Features</h2>
            <div class="mermaid">
flowchart TB
    subgraph NewFeature["Adding a New Feature"]
        Q1{"What type<br>of feature?"}
        
        subgraph NewSyntax["New Syntax (e.g., 'for' loop)"]
            S1["1. Add TokenType<br>(FOR)"]
            S2["2. Update Lexer<br>keywords map"]
            S3["3. Add AST Node<br>(ForStatement)"]
            S4["4. Update Parser<br>parseForStatement()"]
            S5["5. Update Interpreter<br>visitForStatement()"]
        end
        
        subgraph NewOp["New Operator (e.g., '^' power)"]
            O1["1. Add TokenType<br>(POWER)"]
            O2["2. Update Lexer<br>scanToken()"]
            O3["3. Update Parser<br>add to precedence level"]
            O4["4. Update Interpreter<br>handle in visitBinaryExpr"]
        end
        
        subgraph NewBuiltin["New Built-in (e.g., 'round')"]
            B1["1. Add to BuiltinFunction.java"]
            B2["2. Register in Interpreter<br>constructor"]
        end
    end
    
    Q1 -->|"New Statement/<br>Control Flow"| S1
    S1 --> S2 --> S3 --> S4 --> S5
    
    Q1 -->|"New Operator"| O1
    O1 --> O2 --> O3 --> O4
    
    Q1 -->|"New Built-in<br>Function"| B1
    B1 --> B2
    
    style Q1 fill:#8e44ad,stroke:#9b59b6,color:#fff
    style S1 fill:#c0392b,stroke:#e74c3c,color:#fff
    style S3 fill:#d68910,stroke:#f39c12,color:#fff
    style S5 fill:#1e8449,stroke:#27ae60,color:#fff
            </div>
        </div>

        <!-- Legend -->
        <div class="diagram-section">
            <h2>üìã Legend</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color phase-lexer"></div>
                    <span>Lexer Phase (Tokenization)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color phase-parser"></div>
                    <span>Parser Phase (AST Construction)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color phase-interpreter"></div>
                    <span>Interpreter Phase (Execution)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color phase-data"></div>
                    <span>Data Structures (Tokens, AST, Environment)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color phase-output"></div>
                    <span>Output (Console, Return Values)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#1a1a2e',
                primaryColor: '#3498db',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5dade2',
                lineColor: '#5dade2',
                secondaryColor: '#27ae60',
                tertiaryColor: '#2c3e50'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                mirrorActors: false
            }
        });
    </script>
</body>
</html>
